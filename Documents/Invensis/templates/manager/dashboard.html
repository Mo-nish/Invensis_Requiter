{% extends "base.html" %} {% block title %}Manager Dashboard - Invensis Hiring
Portal{% endblock %} {% block head %}
<style>
  /* Star Rating System - Matching Recruiter Dashboard Style */
  .star-rating {
    display: inline-flex;
    align-items: center;
    gap: 2px;
  }
  .star-rating.compact {
    gap: 1px;
  }
  .star {
    font-size: 1.5rem;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s ease;
    user-select: none;
  }
  .star-rating.compact .star {
    font-size: 1.2rem;
  }
  .star:hover,
  .star.active,
  .star.filled {
    color: #fbbf24;
    transform: scale(1.1);
  }
  .star.active {
    color: #fbbf24;
  }
  .star.filled {
    color: #fbbf24;
  }
  .compact-rating-field {
    padding: 8px;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(209, 213, 219, 0.3);
  }
  /* 3D Button Styles */
  .btn-3d {
    position: relative;
    transform: translateY(0);
    transition: all 0.2s ease;
    border: none;
    outline: none;
    cursor: pointer;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
  }
  .btn-3d:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 0 rgba(0, 0, 0, 0.2);
  }
  .btn-3d:active {
    transform: translateY(0);
    box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2);
  }
  .btn-manager {
    background: linear-gradient(135deg, #10b981, #059669);
    color: white;
    border-radius: 8px;
  }
  .btn-cluster {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
    color: white;
    border-radius: 8px;
  }
  .btn-recruiter {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
    border-radius: 8px;
  }
</style>
{% endblock %} {% block content %}
<div class="space-y-6">
    <!-- Header -->
    <div class="bg-white rounded-xl shadow-lg p-6 fade-in">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Manager Dashboard</h1>
                <p class="text-gray-600">Review candidates and provide feedback</p>
            </div>
            <div class="flex items-center space-x-4">
        <a
          href="{{ url_for('manager.export_feedback') }}?format=csv"
          class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg btn-animate"
        >
                    <i class="fas fa-download mr-2"></i>Export CSV
                </a>
        <a
          href="{{ url_for('manager.export_feedback') }}?format=pdf"
          class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg btn-animate"
        >
                    <i class="fas fa-file-pdf mr-2"></i>Export PDF
                </a>
            </div>
        </div>
    </div>

  <!-- Action Buttons -->
  <div class="mb-8 text-center space-x-4">
    <button onclick="window.location.href='/manager/request-candidates'" class="btn-3d bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-8 py-4 text-lg font-semibold shadow-xl transform hover:scale-105 transition-all duration-300 rounded-xl">
      <i class="fas fa-user-plus mr-3"></i>üìù Request Candidates
      <div class="text-sm font-normal mt-1 opacity-90">Submit Candidate Requirements</div>
    </button>
    <button onclick="openDataVisualization()" class="btn-3d bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 text-white px-8 py-4 text-lg font-semibold shadow-xl transform hover:scale-105 transition-all duration-300 rounded-xl">
      <i class="fas fa-chart-line mr-3"></i>üìä Manager Data Analytics
      <div class="text-sm font-normal mt-1 opacity-90">Advanced Performance Insights & Trends</div>
    </button>
  </div>

  <!-- Statistics Cards - 3D Design System -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
    <!-- All Candidates -->
    <div class="dashboard-card-3d">
      <div class="flex items-center">
        <div
          class="w-12 h-12 bg-gradient-to-r from-indigo-400 to-indigo-600 rounded-full flex items-center justify-center mr-4 shadow-lg"
        >
          <i class="fas fa-users text-xl text-white"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-purple-200 mb-1">All Candidates</p>
          <p class="text-2xl font-bold text-white">
            {{ assigned_candidates|length + selected_candidates|length +
            not_selected_candidates|length + reassigned_candidates|length }}
          </p>
        </div>
      </div>
    </div>
    <!-- Selected Candidates -->
    <div class="dashboard-card-3d">
      <div class="flex items-center">
        <div
          class="w-12 h-12 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center mr-4 shadow-lg"
        >
          <i class="fas fa-user-check text-xl text-white"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-purple-200 mb-1">Selected</p>
          <p class="text-2xl font-bold text-white">
            {{ selected_candidates|length }}
          </p>
        </div>
      </div>
    </div>
    <!-- Not Selected Candidates -->
    <div class="dashboard-card-3d">
      <div class="flex items-center">
        <div
          class="w-12 h-12 bg-gradient-to-r from-red-400 to-red-600 rounded-full flex items-center justify-center mr-4 shadow-lg"
        >
          <i class="fas fa-user-times text-xl text-white"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-purple-200 mb-1">Not Selected</p>
          <p class="text-2xl font-bold text-white">
            {{ not_selected_candidates|length }}
          </p>
        </div>
      </div>
    </div>
    <!-- Reassigned Candidates -->
    <div class="dashboard-card-3d">
      <div class="flex items-center">
        <div
          class="w-12 h-12 bg-gradient-to-r from-orange-400 to-orange-600 rounded-full flex items-center justify-center mr-4 shadow-lg"
        >
          <i class="fas fa-exchange-alt text-xl text-white"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-purple-200 mb-1">Reassigned</p>
          <p class="text-2xl font-bold text-white">
            {{ reassigned_candidates|length }}
          </p>
        </div>
      </div>
    </div>

    <!-- Candidate Requests -->
    <div class="dashboard-card-3d">
      <div class="flex items-center">
        <div
          class="w-12 h-12 bg-gradient-to-r from-purple-400 to-purple-600 rounded-full flex items-center justify-center mr-4 shadow-lg"
        >
          <i class="fas fa-clipboard-list text-xl text-white"></i>
        </div>
        <div>
          <p class="text-sm font-medium text-purple-200 mb-1">Candidate Requests</p>
          <p class="text-2xl font-bold text-white" id="total-requests">0</p>
        </div>
      </div>
    </div>
  </div>
    <!-- Tabs -->
    <div class="bg-white rounded-xl shadow-lg fade-in">
        <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6" aria-label="Tabs">
        <button
          onclick="showTab('assigned-candidates-tab')"
          class="tab-button bg-blue-600 text-white px-4 py-3 rounded-t-lg font-medium"
        >
                    <i class="fas fa-user-clock mr-2"></i>Assigned Candidates
                </button>
        <button
          onclick="showTab('selected-candidates-tab')"
          class="tab-button bg-gray-200 text-gray-700 px-4 py-3 rounded-t-lg font-medium"
        >
          <i class="fas fa-user-check mr-2"></i>Selected Candidates
        </button>
        <button
          onclick="showTab('not-selected-candidates-tab')"
          class="tab-button bg-gray-200 text-gray-700 px-4 py-3 rounded-t-lg font-medium"
        >
          <i class="fas fa-user-times mr-2"></i>Not Selected
        </button>
        <button
          onclick="showTab('reassigned-candidates-tab')"
          class="tab-button bg-gray-200 text-gray-700 px-4 py-3 rounded-t-lg font-medium"
        >
          <i class="fas fa-exchange-alt mr-2"></i>Reassigned
                </button>
            </nav>
        </div>
        <!-- Assigned Candidates Tab -->
        <div id="assigned-candidates-tab" class="tab-content active p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-6">
        Assigned Candidates
      </h2>
            {% if assigned_candidates %}
            <div class="space-y-4">
                {% for candidate in assigned_candidates %}
        <div
          class="candidate-card border rounded-lg shadow-md bg-white overflow-hidden transition-all duration-300 hover:shadow-lg"
        >
                    <!-- Collapsed View -->
          <div
            class="candidate-header flex justify-between items-center p-4 cursor-pointer"
            onclick="toggleCandidate('{{ candidate._id }}')"
          >
                        <div class="flex items-center space-x-4">
                            {% if candidate.image_path %}
              <img
                src="{{ url_for('static', filename=candidate.image_path) }}"
                                 alt="{{ candidate.first_name }} {{ candidate.last_name }}" 
                class="w-12 h-12 rounded-full object-cover"
              />
                            {% else %}
              <div
                class="w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center"
              >
                                <i class="fas fa-user text-gray-400"></i>
                            </div>
                            {% endif %}
                            <div>
                <h3 class="text-lg font-semibold text-gray-900">
                  {{ candidate.first_name }} {{ candidate.last_name }}
                </h3>
                                <p class="text-sm text-gray-600">{{ candidate.email }}</p>
                                <p class="text-sm text-gray-500">
                                    <i class="fas fa-calendar mr-1"></i>
                  Interview: {{ candidate.scheduled_date if candidate.scheduled_date else 'Not scheduled' }}
                                </p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
              {% if candidate.onboarding_status == 'Onboarded' %}
                <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full font-medium">
                  Onboarded
                </span>
                {% if candidate.onboarding_date %}
                <span class="text-xs text-gray-600">
                  <i class="fas fa-calendar-check mr-1"></i>{{ candidate.onboarding_date }}
                </span>
                {% endif %}
              {% else %}
                <span
                  class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-medium"
                >
                                {{ candidate.status }}
                            </span>
              {% endif %}
              <button
                class="expand-btn text-gray-400 hover:text-gray-600 transition-transform duration-200"
              >
                                <i class="fas fa-chevron-down"></i>
                            </button>
                        </div>
                    </div>
                    <!-- Expanded View -->
          <div
            id="candidate-{{ candidate._id }}"
            class="candidate-details hidden border-t border-gray-100 bg-gray-50"
          >
                        <div class="p-4 space-y-4">
                            <!-- Candidate Details -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div class="space-y-2">
                                    <p class="text-sm text-gray-600">
                                        <i class="fas fa-phone mr-2"></i>
                    <span class="font-medium">Phone:</span> {{ candidate.phone
                    }}
                                    </p>
                                    <p class="text-sm text-gray-600">
                                        <i class="fas fa-id-badge mr-2"></i>
                    <span class="font-medium">Ref ID:</span> {{
                    candidate.reference_id }}
                                    </p>
                                    <p class="text-sm text-gray-600">
                                        <i class="fas fa-calendar-alt mr-2"></i>
                    <span class="font-medium">Created:</span> {{
                    candidate.created_at if
                    candidate.created_at else 'N/A' }}
                                    </p>
                                </div>
                                <div class="space-y-2">
                  <!-- Detailed Recruiter Ratings -->
                  {% if candidate.communication_skills or candidate.adaptability
                  or candidate.teamwork_collaboration or candidate.job_fit or
                  candidate.overall_rating %}
                  <div class="bg-blue-50 p-3 rounded-lg border border-blue-200">
                    <h4 class="text-sm font-semibold text-blue-800 mb-2">
                      Recruiter Detailed Ratings
                    </h4>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                      <div class="flex items-center">
                        <i class="fas fa-comments mr-1 text-blue-500"></i>
                        <span class="font-medium">Communication:</span>
                        <span class="ml-1">
                          {% if candidate.communication_skills %} {% for i in
                          range(candidate.communication_skills) %}‚≠ê{% endfor %}
                          <span class="text-gray-600"
                            >({{ candidate.communication_skills }}/5)</span
                          >
                                        {% else %}
                                            <span class="text-gray-400">Not rated</span>
                                        {% endif %}
                        </span>
                      </div>
                      <div class="flex items-center">
                        <i class="fas fa-sync-alt mr-1 text-green-500"></i>
                        <span class="font-medium">Adaptability:</span>
                        <span class="ml-1">
                          {% if candidate.adaptability %} {% for i in
                          range(candidate.adaptability) %}‚≠ê{% endfor %}
                          <span class="text-gray-600"
                            >({{ candidate.adaptability }}/5)</span
                          >
                                        {% else %}
                                            <span class="text-gray-400">Not rated</span>
                                        {% endif %}
                        </span>
                      </div>
                      <div class="flex items-center">
                        <i class="fas fa-users mr-1 text-purple-500"></i>
                        <span class="font-medium">Teamwork:</span>
                        <span class="ml-1">
                          {% if candidate.teamwork_collaboration %} {% for i in
                          range(candidate.teamwork_collaboration) %}‚≠ê{% endfor
                          %}
                          <span class="text-gray-600"
                            >({{ candidate.teamwork_collaboration }}/5)</span
                          >
                          {% else %}
                          <span class="text-gray-400">Not rated</span>
                          {% endif %}
                        </span>
                      </div>
                      <div class="flex items-center">
                        <i class="fas fa-briefcase mr-1 text-orange-500"></i>
                        <span class="font-medium">Job Fit:</span>
                        <span class="ml-1">
                          {% if candidate.job_fit %} {% for i in
                          range(candidate.job_fit) %}‚≠ê{% endfor %}
                          <span class="text-gray-600"
                            >({{ candidate.job_fit }}/5)</span
                          >
                          {% else %}
                          <span class="text-gray-400">Not rated</span>
                          {% endif %}
                        </span>
                      </div>
                    </div>
                    {% if candidate.overall_rating %}
                    <div class="mt-2 pt-2 border-t border-blue-200">
                      <div class="flex items-center">
                        <i class="fas fa-robot mr-1 text-pink-500"></i>
                        <span class="font-medium text-pink-700"
                          >Overall Rating:</span
                        >
                        <span class="ml-2 text-lg font-bold text-pink-600"
                          >{{ "%.1f"|format(candidate.overall_rating) }}/5</span
                        >
                      </div>
                    </div>
                    {% endif %} {% if candidate.other_notes %}
                    <div class="mt-2 pt-2 border-t border-blue-200">
                      <div class="flex items-start">
                        <i
                          class="fas fa-sticky-note mr-1 text-yellow-500 mt-0.5"
                        ></i>
                        <span class="font-medium text-yellow-700">Notes:</span>
                        <span class="ml-2 text-gray-700"
                          >{{ candidate.other_notes[:100] }}{% if
                          candidate.other_notes|length > 100 %}...{% endif
                          %}</span
                        >
                      </div>
                    </div>
                    {% endif %}
                  </div>
                  {% else %}
                  <!-- No detailed ratings available -->
                  <p class="text-sm text-gray-400">
                    <i class="fas fa-info-circle mr-2 text-gray-400"></i>
                    <span class="font-medium"
                      >Detailed ratings not available</span
                    >
                  </p>
                  {% endif %}
                  <!-- Skills Display -->
                  {% if candidate.skills %}
                                    <p class="text-sm text-gray-600">
                    <i class="fas fa-tools mr-2 text-purple-500"></i>
                    <span class="font-medium">Skills:</span>
                    <span class="text-xs text-gray-500"
                      >{{ candidate.skills|join(', ') }}</span
                    >
                                    </p>
                                    {% endif %}
                  <!-- Manager Ratings -->
                  {% if candidate.manager_feedback and (candidate.manager_feedback.communication_skills or
                  candidate.manager_feedback.technical_skills or
                  candidate.manager_feedback.problem_solving or
                  candidate.manager_feedback.cultural_fit or
                  candidate.manager_feedback.overall_rating) %}
                  <div
                    class="bg-green-50 p-3 rounded-lg border border-green-200"
                  >
                    <h4 class="text-sm font-semibold text-green-800 mb-2">
                      Manager Round Ratings
                    </h4>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                      <div class="flex items-center">
                        <i class="fas fa-comments mr-1 text-blue-500"></i>
                        <span class="font-medium">Communication:</span>
                        <span class="ml-1">
                          {% if candidate.manager_feedback.communication_skills %} {% for
                          i in range(candidate.manager_feedback.communication_skills)
                          %}‚≠ê{% endfor %}
                          <span class="text-gray-600"
                            >({{ candidate.manager_feedback.communication_skills
                            }}/5)</span
                          >
                          {% else %}
                          <span class="text-gray-400">Not rated</span>
                          {% endif %}
                        </span>
                                </div>
                      <div class="flex items-center">
                        <i class="fas fa-cog mr-1 text-green-500"></i>
                        <span class="font-medium">Technical:</span>
                        <span class="ml-1">
                          {% if candidate.manager_feedback.technical_skills %} {% for i in
                          range(candidate.manager_feedback.technical_skills) %}‚≠ê{%
                          endfor %}
                          <span class="text-gray-600"
                            >({{ candidate.manager_feedback.technical_skills }}/5)</span
                          >
                          {% else %}
                          <span class="text-gray-400">Not rated</span>
                          {% endif %}
                        </span>
                            </div>
                      <div class="flex items-center">
                        <i class="fas fa-lightbulb mr-1 text-yellow-500"></i>
                        <span class="font-medium">Problem Solving:</span>
                        <span class="ml-1">
                          {% if candidate.manager_feedback.problem_solving %} {% for i in
                          range(candidate.manager_feedback.problem_solving) %}‚≠ê{% endfor
                          %}
                          <span class="text-gray-600"
                            >({{ candidate.manager_feedback.problem_solving }}/5)</span
                          >
                          {% else %}
                          <span class="text-gray-400">Not rated</span>
                          {% endif %}
                        </span>
                      </div>
                      <div class="flex items-center">
                        <i class="fas fa-users mr-1 text-purple-500"></i>
                        <span class="font-medium">Cultural Fit:</span>
                        <span class="ml-1">
                          {% if candidate.manager_feedback.cultural_fit %} {% for i in
                          range(candidate.manager_feedback.cultural_fit) %}‚≠ê{% endfor %}
                          <span class="text-gray-600"
                            >({{ candidate.manager_feedback.cultural_fit }}/5)</span
                          >
                          {% else %}
                          <span class="text-gray-400">Not rated</span>
                          {% endif %}
                        </span>
                      </div>
                    </div>
                    {% if candidate.manager_feedback.overall_rating %}
                    <div class="mt-2 pt-2 border-t border-green-200">
                      <div class="flex items-center">
                        <i class="fas fa-brain mr-1 text-pink-500"></i>
                        <span class="font-medium text-pink-700"
                          >Overall Rating:</span
                        >
                        <span class="ml-2 text-lg font-bold text-pink-600"
                          >{{ "%.1f"|format(candidate.manager_feedback.overall_rating)
                          }}/5</span
                        >
                      </div>
                    </div>
                    {% endif %} {% if candidate.manager_feedback %}
                    <div class="mt-2 pt-2 border-t border-green-200">
                      <div class="flex items-start">
                        <i class="fas fa-comment mr-1 text-blue-500 mt-0.5"></i>
                        <span class="font-medium text-blue-700">Feedback:</span>
                        <span class="ml-2 text-gray-700"
                          >{% if candidate.manager_feedback and candidate.manager_feedback.feedback %}{{ candidate.manager_feedback.feedback[:100] }}{% if candidate.manager_feedback.feedback|length > 100 %}...{% endif %}{% else %}No feedback{% endif %}</span
                        >
                      </div>
                    </div>
                    {% endif %}
                  </div>
                  {% endif %}
                </div>
              </div>
                            <!-- Action Buttons -->
                            <div class="flex flex-wrap gap-3 pt-3 border-t border-gray-200">
                <a
                  href="{{ url_for('manager.candidate_details', candidate_id=candidate._id) }}"
                  class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg btn-animate flex items-center"
                >
                                    <i class="fas fa-eye mr-2"></i>View Details
                                </a>
                <button
                  data-candidate-id="{{ candidate._id }}"
                                        data-candidate-name="{{ candidate.first_name }} {{ candidate.last_name }}"
                                        onclick="showFeedbackModal(this.dataset.candidateId, this.dataset.candidateName)"
                  class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg btn-animate flex items-center"
                >
                                    <i class="fas fa-comment mr-2"></i>Add Feedback
                                </button>
                                {% if candidate.resume_path %}
                <a
                  href="{{ url_for('static', filename=candidate.resume_path.replace('static/', '')) }}"
                                   target="_blank"
                  class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg btn-animate flex items-center"
                >
                                    <i class="fas fa-download mr-2"></i>Download Resume
                                </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="text-center py-12">
                <i class="fas fa-user-clock text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          No Assigned Candidates
        </h3>
        <p class="text-gray-500">
          You don't have any candidates assigned to you yet.
        </p>
            </div>
            {% endif %}
        </div>
    <!-- Selected Candidates Tab -->
    <div
      id="selected-candidates-tab"
      class="tab-content p-6"
      style="display: none"
    >
      <h2 class="text-xl font-semibold text-gray-900 mb-6">
        Selected Candidates
      </h2>
      {% if selected_candidates %}
            <div class="overflow-x-auto">
                <table class="min-w-full bg-white border border-gray-200 rounded-lg">
                    <thead class="bg-gray-50">
                        <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                <input
                  type="checkbox"
                  id="select-all"
                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                />
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Candidate
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Feedback
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Manager Rating
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Date
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Actions
              </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
            {% for candidate in selected_candidates %}
                        <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <input
                  type="checkbox"
                  class="select-item w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                  data-id="{{ candidate._id }}"
                  data-name="{{ candidate.first_name }} {{ candidate.last_name }}"
                />
              </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="flex items-center">
                                    {% if candidate.image_path %}
                  <img
                    src="{{ url_for('static', filename=candidate.image_path) }}"
                                         alt="{{ candidate.first_name }} {{ candidate.last_name }}" 
                    class="w-10 h-10 rounded-full object-cover mr-3"
                  />
                                    {% else %}
                  <div
                    class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center mr-3"
                  >
                                        <i class="fas fa-user text-gray-400"></i>
                                    </div>
                                    {% endif %}
                                    <div>
                    <div class="text-sm font-medium text-gray-900">
                      {{ candidate.first_name }} {{ candidate.last_name }}
                    </div>
                    <div class="text-sm text-gray-500">
                      {{ candidate.email }}
                    </div>
                                    </div>
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                {% if candidate.onboarding_status == 'Onboarded' %}
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Onboarded
                  </span>
                  {% if candidate.onboarding_date %}
                  <div class="text-xs text-gray-600 mt-1">
                    <i class="fas fa-calendar-check mr-1"></i>{{ candidate.onboarding_date }}
                  </div>
                  {% endif %}
                {% else %}
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                    {{ candidate.status }}
                                </span>
                {% endif %}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.manager_feedback and candidate.manager_feedback.feedback %}
                    {% set feedback_text = candidate.manager_feedback.feedback[:50] %}
                    {{ feedback_text }}{% if candidate.manager_feedback.feedback|length > 50 %}...{% endif %}
                                {% else %}
                                    <span class="text-gray-400">No feedback</span>
                                {% endif %}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.manager_feedback and candidate.manager_feedback.overall_rating %}
                <div class="flex items-center space-x-1">
                  <span class="font-medium text-green-600"
                    >{{ "%.1f"|format(candidate.manager_feedback.overall_rating)
                    }}/5</span
                  >
                  <i class="fas fa-star text-yellow-500 text-xs"></i>
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  {% if candidate.manager_feedback.communication_skills %}C:{{
                  candidate.manager_feedback.communication_skills }}{% endif %} {% if
                  candidate.manager_feedback.technical_skills %} | T:{{
                  candidate.manager_feedback.technical_skills }}{% endif %} {% if
                  candidate.manager_feedback.problem_solving %} | P:{{
                  candidate.manager_feedback.problem_solving }}{% endif %} {% if
                  candidate.manager_feedback.cultural_fit %} | F:{{
                  candidate.manager_feedback.cultural_fit }}{% endif %}
                </div>
                {% else %}
                <span class="text-gray-400 text-xs">Not rated</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.reviewed_at %}
                    {% if candidate.reviewed_at is string %}
                        {{ candidate.reviewed_at[:10] if candidate.reviewed_at|length > 10 else candidate.reviewed_at }}
                    {% else %}
                                {{ candidate.reviewed_at.strftime('%Y-%m-%d') if candidate.reviewed_at else 'N/A' }}
                    {% endif %}
                {% else %}
                    N/A
                {% endif %}
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <div class="flex space-x-2">
                  <a
                    href="{{ url_for('manager.candidate_details', candidate_id=candidate._id) }}"
                    class="text-blue-600 hover:text-blue-900 btn-animate"
                  >
                                        <i class="fas fa-eye"></i>
                                    </a>
                  <button
                    data-candidate-id="{{ candidate._id }}"
                    data-candidate-name="{% if candidate.name %}{{ candidate.name }}{% elif candidate.first_name and candidate.last_name %}{{ candidate.first_name }} {{ candidate.last_name }}{% elif candidate.first_name %}{{ candidate.first_name }}{% else %}Candidate{% endif %}"
                                            onclick="showReassignModal(this.dataset.candidateId, this.dataset.candidateName)"
                    class="text-orange-600 hover:text-orange-900 btn-animate"
                  >
                                        <i class="fas fa-undo"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-12">
                <i class="fas fa-user-check text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          No Selected Candidates
        </h3>
        <p class="text-gray-500">You haven't selected any candidates yet.</p>
            </div>
            {% endif %}
        </div>
    <!-- Not Selected Candidates Tab -->
    <div
      id="not-selected-candidates-tab"
      class="tab-content p-6"
      style="display: none"
    >
      <h2 class="text-xl font-semibold text-gray-900 mb-6">
        Not Selected Candidates
      </h2>
      {% if not_selected_candidates %}
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                <input
                  type="checkbox"
                  id="select-all-not-selected"
                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                />
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Candidate
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Feedback
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Reasons for Not Selected
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Date
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for candidate in not_selected_candidates %}
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <input
                  type="checkbox"
                  class="select-item w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                  data-id="{{ candidate._id }}"
                  data-name="{{ candidate.first_name }} {{ candidate.last_name }}"
                />
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10">
                    <img
                      class="h-10 w-10 rounded-full"
                      src="{{ candidate.profile_picture if candidate.profile_picture else url_for('static', filename='images/default-avatar.svg') }}"
                      alt="{{ candidate.name if candidate.name else candidate.first_name + ' ' + candidate.last_name if candidate.first_name and candidate.last_name else 'Candidate' }}"
                    />
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {% if candidate.name %}
                        {{ candidate.name }}
                      {% elif candidate.first_name and candidate.last_name %}
                        {{ candidate.first_name }} {{ candidate.last_name }}
                      {% elif candidate.first_name %}
                        {{ candidate.first_name }}
                      {% else %}
                        Name not available
                      {% endif %}
</div>
                    <div class="text-sm text-gray-500">
                      {{ candidate.email if candidate.email else 'Email not available' }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {% if candidate.onboarding_status == 'Onboarded' %}
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Onboarded
                  </span>
                  {% if candidate.onboarding_date %}
                  <div class="text-xs text-gray-600 mt-1">
                    <i class="fas fa-calendar-check mr-1"></i>{{ candidate.onboarding_date }}
                  </div>
                  {% endif %}
                {% else %}
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                    {{ candidate.status }}
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.manager_feedback and candidate.manager_feedback.feedback %}
                    {% set feedback_text = candidate.manager_feedback.feedback[:50] %}
                    {{ feedback_text }}{% if candidate.manager_feedback.feedback|length > 50 %}...{% endif %}
                {% else %}
                    <span class="text-gray-400">No feedback</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.rejection_reasons %}
                <div class="space-y-1">
                  {% for reason in candidate.rejection_reasons %}
                  <div class="flex items-center space-x-2">
                    <i class="fas fa-times text-red-500 text-xs"></i>
                    <span class="text-xs text-gray-700">{{ reason }}</span>
                  </div>
                  {% endfor %} {% if candidate.rejection_notes %}
                  <div
                    class="mt-2 p-2 bg-gray-50 rounded border-l-2 border-red-300"
                  >
                    <span class="text-xs text-gray-600 font-medium"
                      >Notes:</span
                    >
                    <p class="text-xs text-gray-700 mt-1">
                      {{ candidate.rejection_notes }}
                    </p>
                  </div>
                  {% endif %}
                </div>
                {% else %}
                <button
                  onclick="showRejectionReasonsModal('{{ candidate._id }}', '{% if candidate.name %}{{ candidate.name }}{% elif candidate.first_name and candidate.last_name %}{{ candidate.first_name }} {{ candidate.last_name }}{% elif candidate.first_name %}{{ candidate.first_name }}{% else %}Candidate{% endif %}')"
                  class="text-xs bg-red-100 text-red-700 px-2 py-1 rounded-full hover:bg-red-200 transition-colors"
                >
                  <i class="fas fa-plus mr-1"></i>Add Reasons
                </button>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.reviewed_at %}
                    {% if candidate.reviewed_at is string %}
                        {{ candidate.reviewed_at[:10] if candidate.reviewed_at|length > 10 else candidate.reviewed_at }}
                    {% else %}
                        {{ candidate.reviewed_at.strftime('%Y-%m-%d') if candidate.reviewed_at else 'N/A' }}
                    {% endif %}
                {% else %}
                    N/A
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex space-x-2">
                  <a
                    href="{{ url_for('manager.candidate_details', candidate_id=candidate._id) }}"
                    class="text-blue-600 hover:text-blue-900 btn-animate"
                  >
                    <i class="fas fa-eye"></i>
                  </a>
                  <button
                    data-candidate-id="{{ candidate._id }}"
                    data-candidate-name="{% if candidate.name %}{{ candidate.name }}{% elif candidate.first_name and candidate.last_name %}{{ candidate.first_name }} {{ candidate.last_name }}{% elif candidate.first_name %}{{ candidate.first_name }}{% else %}Candidate{% endif %}"
                    onclick="showReassignModal(this.dataset.candidateId, this.dataset.candidateName)"
                    class="text-orange-600 hover:text-orange-900 btn-animate"
                  >
                    <i class="fas fa-undo"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-12">
        <i class="fas fa-user-times text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          No Not Selected Candidates
        </h3>
        <p class="text-gray-500">
          You haven't marked any candidates as not selected yet.
        </p>
      </div>
      {% endif %}
    </div>
    <!-- Reassigned Candidates Tab -->
    <div
      id="reassigned-candidates-tab"
      class="tab-content p-6"
      style="display: none"
    >
      <h2 class="text-xl font-semibold text-gray-900 mb-6">
        Reassigned Candidates
      </h2>
      {% if reassigned_candidates %}
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200 rounded-lg">
          <thead class="bg-gray-50">
            <tr>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                <input
                  type="checkbox"
                  id="select-all-reassigned"
                  class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                />
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Candidate
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Status
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Feedback
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Manager Rating
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Date
              </th>
              <th
                class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
              >
                Actions
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for candidate in reassigned_candidates %}
            <tr class="hover:bg-gray-50">
              <td class="px-6 py-4 whitespace-nowrap">
                <input
                  type="checkbox"
                  class="select-item w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
                  data-id="{{ candidate._id }}"
                  data-name="{{ candidate.first_name }} {{ candidate.last_name }}"
                />
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-10 w-10">
                    <img
                      class="h-10 w-10 rounded-full"
                      src="{{ candidate.profile_picture if candidate.profile_picture else url_for('static', filename='images/default-avatar.svg') }}"
                      alt="{{ candidate.name if candidate.name else candidate.last_name if candidate.first_name and candidate.last_name else 'Candidate' }}"
                    />
                  </div>
                  <div class="ml-4">
                    <div class="text-sm font-medium text-gray-900">
                      {% if candidate.name %}
                        {{ candidate.name }}
                      {% elif candidate.first_name and candidate.last_name %}
                        {{ candidate.first_name }} {{ candidate.last_name }}
                      {% elif candidate.first_name %}
                        {{ candidate.first_name }}
                      {% else %}
                        Name not available
                      {% endif %}
                    </div>
                    <div class="text-sm text-gray-500">
                      {{ candidate.email if candidate.email else 'Email not available' }}
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {% if candidate.onboarding_status == 'Onboarded' %}
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    Onboarded
                  </span>
                  {% if candidate.onboarding_date %}
                  <div class="text-xs text-gray-600 mt-1">
                    <i class="fas fa-calendar-check mr-1"></i>{{ candidate.onboarding_date }}
                  </div>
                  {% endif %}
                {% else %}
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-orange-100 text-orange-800">
                    {{ candidate.status }}
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.manager_feedback and candidate.manager_feedback.feedback %}
                    {% set feedback_text = candidate.manager_feedback.feedback[:50] %}
                    {{ feedback_text }}{% if candidate.manager_feedback.feedback|length > 50 %}...{% endif %}
                {% else %}
                    <span class="text-gray-400">No feedback</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.manager_feedback and candidate.manager_feedback.overall_rating %}
                <div class="flex items-center space-x-1">
                  <span class="font-medium text-green-600"
                    >{{ "%.1f"|format(candidate.manager_feedback.overall_rating)
                    }}/5</span
                  >
                  <i class="fas fa-star text-yellow-500 text-xs"></i>
                </div>
                <div class="text-xs text-gray-500 mt-1">
                  {% if candidate.manager_feedback.communication_skills %}C:{{
                  candidate.manager_feedback.communication_skills }}{% endif %} {% if
                  candidate.manager_feedback.technical_skills %} | T:{{
                  candidate.manager_feedback.technical_skills }}{% endif %} {% if
                  candidate.manager_feedback.problem_solving %} | P:{{
                  candidate.manager_feedback.problem_solving }}{% endif %} {% if
                  candidate.manager_feedback.cultural_fit %} | F:{{
                  candidate.manager_feedback.cultural_fit }}{% endif %}
                </div>
                {% else %}
                <span class="text-gray-400 text-xs">Not rated</span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                {% if candidate.reviewed_at %}
                    {% if candidate.reviewed_at is string %}
                        {{ candidate.reviewed_at[:10] if candidate.reviewed_at|length > 10 else candidate.reviewed_at }}
                    {% else %}
                        {{ candidate.reviewed_at.strftime('%Y-%m-%d') if candidate.reviewed_at else 'N/A' }}
                    {% endif %}
                {% else %}
                    N/A
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                <div class="flex space-x-2">
                  <a
                    href="{{ url_for('manager.candidate_details', candidate_id=candidate._id) }}"
                    class="text-blue-600 hover:text-blue-900 btn-animate"
                  >
                    <i class="fas fa-eye"></i>
                  </a>
                  <button
                    data-candidate-id="{{ candidate._id }}"
                    data-candidate-name="{% if candidate.name %}{{ candidate.name }}{% elif candidate.first_name and candidate.last_name %}{{ candidate.first_name }} {{ candidate.last_name }}{% elif candidate.first_name %}{{ candidate.first_name }}{% else %}Candidate{% endif %}"
                    onclick="showReassignModal(this.dataset.candidateId, this.dataset.candidateName)"
                    class="text-orange-600 hover:text-orange-900 btn-animate"
                  >
                    <i class="fas fa-undo"></i>
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-12">
        <i class="fas fa-exchange-alt text-4xl text-gray-300 mb-4"></i>
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          No Reassigned Candidates
        </h3>
        <p class="text-gray-500">You haven't reassigned any candidates yet.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>
<!-- Feedback Modal -->
<div
  id="feedbackModal"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50"
>
  <div
    class="bg-white rounded-xl shadow-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"
  >
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Add Feedback</h3>
      <button
        onclick="hideFeedbackModal()"
        class="text-gray-400 hover:text-gray-600"
      >
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="feedbackForm" method="POST">
      <input type="hidden" id="feedbackCandidateId" name="candidate_id" />
            <div class="space-y-4">
                <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Candidate</label
          >
                    <p id="feedbackCandidateName" class="text-gray-900 font-medium"></p>
                </div>
                <div>
          <label
            for="feedbackStatus"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Status *</label
          >
          <select
            id="feedbackStatus"
            name="status"
            required
            onchange="toggleFeedbackSections()"
            class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="" disabled selected>Select Status</option>
            <option value="Selected">Selected</option>
            <option value="Not Selected">Not Selected</option>
            <option value="Reassigned">Reassigned</option>
                    </select>
                </div>
        <!-- Manager Round Rating System - Show only when status is "Selected" -->
        <div id="managerRatingSection" class="hidden">
          <div
            class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6 border border-blue-200"
          >
            <div class="text-center mb-4">
              <div
                class="inline-flex items-center justify-center w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full mb-2 shadow-lg"
              >
                <i class="fas fa-star text-lg text-white"></i>
              </div>
              <h4 class="text-lg font-bold text-gray-700">
                Manager Round Rating
              </h4>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Communication Skills -->
              <div class="compact-rating-field">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                  <i class="fas fa-comments mr-1 text-blue-400"></i
                  >Communication Skills *
                </label>
                <div
                  class="star-rating compact"
                  data-field="communication_skills"
                >
                  <span class="star" data-rating="1">‚óã</span>
                  <span class="star" data-rating="2">‚óã</span>
                  <span class="star" data-rating="3">‚óã</span>
                  <span class="star" data-rating="4">‚óã</span>
                  <span class="star" data-rating="5">‚óã</span>
                </div>
                <input
                  type="hidden"
                  id="communication_skills"
                  name="communication_skills"
                  value="0"
                />
              </div>
              <!-- Technical Skills -->
              <div class="compact-rating-field">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                  <i class="fas fa-cog mr-1 text-green-400"></i>Technical Skills
                  *
                </label>
                <div class="star-rating compact" data-field="technical_skills">
                  <span class="star" data-rating="1">‚óã</span>
                  <span class="star" data-rating="2">‚óã</span>
                  <span class="star" data-rating="3">‚óã</span>
                  <span class="star" data-rating="4">‚óã</span>
                  <span class="star" data-rating="5">‚óã</span>
                </div>
                <input
                  type="hidden"
                  id="technical_skills"
                  name="technical_skills"
                  value="0"
                />
              </div>
              <!-- Problem Solving -->
              <div class="compact-rating-field">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                  <i class="fas fa-lightbulb mr-1 text-yellow-400"></i>Problem
                  Solving *
                </label>
                <div class="star-rating compact" data-field="problem_solving">
                  <span class="star" data-rating="1">‚óã</span>
                  <span class="star" data-rating="2">‚óã</span>
                  <span class="star" data-rating="3">‚óã</span>
                  <span class="star" data-rating="4">‚óã</span>
                  <span class="star" data-rating="5">‚óã</span>
                </div>
                <input
                  type="hidden"
                  id="problem_solving"
                  name="problem_solving"
                  value="0"
                />
              </div>
              <!-- Cultural Fit -->
              <div class="compact-rating-field">
                <label class="block text-sm font-semibold text-gray-700 mb-2">
                  <i class="fas fa-users mr-1 text-purple-400"></i>Cultural Fit
                  *
                </label>
                <div class="star-rating compact" data-field="cultural_fit">
                  <span class="star" data-rating="1">‚óã</span>
                  <span class="star" data-rating="2">‚óã</span>
                  <span class="star" data-rating="3">‚óã</span>
                  <span class="star" data-rating="4">‚óã</span>
                  <span class="star" data-rating="5">‚óã</span>
                </div>
                <input
                  type="hidden"
                  id="cultural_fit"
                  name="cultural_fit"
                  value="0"
                />
              </div>
            </div>
            <!-- Overall Rating Display -->
            <div
              class="mt-4 p-3 bg-gradient-to-r from-pink-50 to-blue-50 rounded border border-pink-200"
            >
              <div class="flex items-center justify-between text-sm">
                <span class="text-pink-700">
                  <i class="fas fa-brain mr-1"></i>AI calculates overall rating
                  automatically
                </span>
                <div class="flex space-x-2">
                  <button
                    type="button"
                    onclick="calculateManagerOverallRating()"
                    class="btn-3d btn-manager px-3 py-1 text-xs font-semibold transform hover:scale-105 transition-all duration-300"
                  >
                    <i class="fas fa-calculator mr-1"></i>Calculate
                  </button>
                  <button
                    type="button"
                    onclick="resetManagerRatings()"
                    class="btn-3d btn-cluster px-3 py-1 text-xs font-semibold transform hover:scale-105 transition-all duration-300"
                  >
                    <i class="fas fa-refresh mr-1"></i>Reset
                  </button>
                </div>
              </div>
            </div>
            <!-- Overall Rating Result -->
            <div class="mt-3 text-center">
              <div class="inline-flex items-center justify-center">
                <span class="text-sm font-medium text-gray-700 mr-2"
                  >Overall Rating:</span
                >
                <span
                  id="manager_overall_rating_display"
                  class="text-3xl font-bold text-pink-400 mb-2"
                  >--</span
                >
                <input
                  type="hidden"
                  id="manager_overall_rating"
                  name="overall_rating"
                  value="0"
                />
              </div>
            </div>
          </div>
        </div>
        <!-- Rejection Reasons Section - Show only when status is "Not Selected" -->
        <div id="rejectionReasonsSection" class="hidden">
          <div
            class="bg-gradient-to-r from-red-50 to-orange-50 rounded-lg p-6 border border-red-200"
          >
            <div class="text-center mb-4">
              <div
                class="inline-flex items-center justify-center w-10 h-10 bg-red-500 rounded-full mb-2 shadow-lg"
              >
                <i class="fas fa-times text-xl text-white"></i>
              </div>
              <h4 class="text-lg font-bold text-gray-700">Rejection Reasons</h4>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_wfh_preference"
                  name="feedback_rejection_reasons"
                  value="WFH preference"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label
                  for="feedback_wfh_preference"
                  class="text-sm text-gray-700"
                  >WFH preference</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_day_shift"
                  name="feedback_rejection_reasons"
                  value="Only Day shift preferred"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label for="feedback_day_shift" class="text-sm text-gray-700"
                  >Only Day shift preferred</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_night_shift"
                  name="feedback_rejection_reasons"
                  value="Only Night shift preferred"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label for="feedback_night_shift" class="text-sm text-gray-700"
                  >Only Night shift preferred</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_not_budget"
                  name="feedback_rejection_reasons"
                  value="Not in the budget"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label for="feedback_not_budget" class="text-sm text-gray-700"
                  >Not in the budget</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_failed_assessment"
                  name="feedback_rejection_reasons"
                  value="Failed in assessment"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label
                  for="feedback_failed_assessment"
                  class="text-sm text-gray-700"
                  >Failed in assessment</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_not_flexible"
                  name="feedback_rejection_reasons"
                  value="Not flexible"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label for="feedback_not_flexible" class="text-sm text-gray-700"
                  >Not flexible</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_not_relevant"
                  name="feedback_rejection_reasons"
                  value="Not relevant experience/skills"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label for="feedback_not_relevant" class="text-sm text-gray-700"
                  >Not relevant experience/skills</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_lack_communication"
                  name="feedback_rejection_reasons"
                  value="Lack communication"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label
                  for="feedback_lack_communication"
                  class="text-sm text-gray-700"
                  >Lack communication</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_poor_technical"
                  name="feedback_rejection_reasons"
                  value="Poor technical knowledge"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label
                  for="feedback_poor_technical"
                  class="text-sm text-gray-700"
                  >Poor technical knowledge</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_over_qualified"
                  name="feedback_rejection_reasons"
                  value="Over qualified"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label
                  for="feedback_over_qualified"
                  class="text-sm text-gray-700"
                  >Over qualified</label
                >
              </div>
              <div class="flex items-center space-x-3">
                <input
                  type="checkbox"
                  id="feedback_other"
                  name="feedback_rejection_reasons"
                  value="other"
                  onchange="toggleFeedbackOtherNotes()"
                  class="w-4 h-4 text-red-600 bg-gray-100 border-gray-300 rounded focus:ring-red-500 focus:ring-2"
                />
                <label for="feedback_other" class="text-sm text-gray-700"
                  >Other</label
                >
              </div>
            </div>
            <div id="feedbackOtherNotesField" class="mt-3 hidden">
              <label
                for="feedbackOtherNotes"
                class="block text-sm font-medium text-gray-700 mb-2"
                >Additional Notes</label
              >
              <textarea
                id="feedbackOtherNotes"
                name="feedback_other_notes"
                rows="3"
                class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                placeholder="Please specify the reason..."
              ></textarea>
            </div>
          </div>
        </div>
                <div>
          <label
            for="feedbackOverallImpression"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Overall Impression</label
          >
          <textarea
            id="feedbackOverallImpression"
            name="overall_impression"
            rows="2"
                              class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Brief overall impression of the candidate..."
          ></textarea>
                </div>
        <div>
          <label
            for="feedbackText"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Detailed Feedback *</label
          >
          <textarea
            id="feedbackText"
            name="feedback"
            rows="4"
            required
            class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Provide detailed feedback about the candidate's performance, strengths, areas for improvement..."
          ></textarea>
        </div>
                <div class="flex space-x-3">
          <button
            type="submit"
            class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg btn-animate"
          >
                        <i class="fas fa-save mr-2"></i>Save Feedback
                    </button>
          <button
            type="button"
            onclick="hideFeedbackModal()"
            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg btn-animate"
          >
                        Cancel
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Reassign Modal -->
<div
  id="reassignModal"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50"
>
    <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-md mx-4">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-lg font-semibold text-gray-900">Reassign Candidate</h3>
      <button
        onclick="hideReassignModal()"
        class="text-gray-400 hover:text-gray-600"
      >
                <i class="fas fa-times"></i>
            </button>
        </div>
        <form id="reassignForm">
            <div class="space-y-4">
                <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Candidate</label
          >
                    <p id="reassignCandidateName" class="text-gray-900 font-medium"></p>
                </div>
                <div>
          <label
            for="reassignNote"
            class="block text-sm font-medium text-gray-700 mb-2"
            >Note (Optional)</label
          >
          <textarea
            id="reassignNote"
            name="note"
            rows="3"
                              class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Add a note for Recruiter..."
          ></textarea>
                </div>
                <div class="flex space-x-3">
          <button
            type="submit"
            class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-2 px-4 rounded-lg btn-animate"
          >
            <i class="fas fa-undo mr-2"></i>Reassign to Recruiter
                    </button>
          <button
            type="button"
            onclick="hideReassignModal()"
            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg btn-animate"
          >
                        Cancel
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>
<!-- Rejection Reasons Modal -->
<div
  id="rejectionReasonsModal"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50"
>
  <div
    class="bg-white rounded-xl shadow-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto"
  >
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold text-gray-900">
        Reasons for Not Selected
      </h3>
      <button
        onclick="hideRejectionReasonsModal()"
        class="text-gray-400 hover:text-gray-600"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    <form id="rejectionReasonsForm">
      <input type="hidden" id="rejectionCandidateId" name="candidate_id" />
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2"
            >Candidate</label
          >
          <p id="rejectionCandidateName" class="text-gray-900 font-medium"></p>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-3"
            >Select Reasons for Not Selecting *</label
          >
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="wfh_preference"
                name="rejection_reasons"
                value="WFH preference"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="wfh_preference" class="text-sm text-gray-700"
                >WFH preference</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="day_shift"
                name="rejection_reasons"
                value="Only Day shift preferred"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="day_shift" class="text-sm text-gray-700"
                >Only Day shift preferred</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="night_shift"
                name="rejection_reasons"
                value="Only Night shift preferred"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="night_shift" class="text-sm text-gray-700"
                >Only Night shift preferred</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="not_budget"
                name="rejection_reasons"
                value="Not in the budget"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="not_budget" class="text-sm text-gray-700"
                >Not in the budget</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="failed_assessment"
                name="rejection_reasons"
                value="Failed in assessment"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="failed_assessment" class="text-sm text-gray-700"
                >Failed in assessment</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="not_flexible"
                name="rejection_reasons"
                value="Not flexible"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="not_flexible" class="text-sm text-gray-700"
                >Not flexible</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="not_relevant"
                name="rejection_reasons"
                value="Not relevant experience/skills"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="not_relevant" class="text-sm text-gray-700"
                >Not relevant experience/skills</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="lack_communication"
                name="rejection_reasons"
                value="Lack communication"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="lack_communication" class="text-sm text-gray-700"
                >Lack communication</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="poor_technical"
                name="rejection_reasons"
                value="Poor technical knowledge"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="poor_technical" class="text-sm text-gray-700"
                >Poor technical knowledge</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="over_qualified"
                name="rejection_reasons"
                value="Over qualified"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="over_qualified" class="text-sm text-gray-700"
                >Over qualified</label
              >
            </div>
            <div class="flex items-center space-x-3">
              <input
                type="checkbox"
                id="other"
                name="rejection_reasons"
                value="other"
                onchange="toggleOtherNotes()"
                class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"
              />
              <label for="other" class="text-sm text-gray-700">Other</label>
            </div>
          </div>
          <div id="otherNotesField" class="mt-3 hidden">
            <label
              for="otherNotes"
              class="block text-sm font-medium text-gray-700 mb-2"
              >Additional Notes</label
            >
            <textarea
              id="otherNotes"
              name="other_notes"
              rows="3"
              class="block w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              placeholder="Please specify the reason..."
            ></textarea>
          </div>
        </div>
        <div class="flex space-x-3 pt-4">
          <button
            type="button"
            onclick="saveRejectionReasons()"
            class="flex-1 bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg btn-animate"
          >
            <i class="fas fa-save mr-2"></i>Save Reasons
          </button>
          <button
            type="button"
            onclick="hideRejectionReasonsModal()"
            class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg btn-animate"
          >
            Cancel
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
<!-- Bulk Action Bar -->
<div
  id="bulk-action-bar"
  class="fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white rounded-lg shadow-lg border border-gray-200 px-6 py-3 hidden z-50"
>
  <div class="flex items-center space-x-4">
    <span id="selected-count" class="text-sm font-medium text-gray-700"
      >0 selected</span
    >
    <div class="flex items-center space-x-2">
      <button
        onclick="bulkMove('Selected')"
        class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
      >
        <i class="fas fa-check mr-1"></i>Select
      </button>
      <button
        onclick="bulkMove('Not Selected')"
        class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
      >
        <i class="fas fa-times mr-1"></i>Not Select
      </button>
      <button
        onclick="bulkReassign()"
        class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors"
      >
        <i class="fas fa-undo mr-1"></i>Reassign
      </button>
    </div>
    <button
      onclick="clearSelection()"
      class="text-gray-500 hover:text-gray-700 text-sm font-medium"
    >
      <i class="fas fa-times mr-1"></i>Clear
    </button>
  </div>
</div>
<!-- Bulk Action Confirmation Modal -->
<div
  id="bulkActionModal"
  class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50"
>
  <div class="flex items-center justify-center min-h-screen">
    <div class="bg-white rounded-lg p-6 max-w-md w-full mx-4">
      <div class="flex items-center mb-4">
        <div
          class="w-10 h-10 bg-red-100 rounded-full flex items-center justify-center mr-3"
        >
          <i class="fas fa-exclamation-triangle text-red-600"></i>
        </div>
        <h3 class="text-lg font-semibold text-gray-900" id="modalTitle">
          Confirm Action
        </h3>
      </div>
      <p class="text-gray-600 mb-6" id="modalMessage">
        Are you sure you want to perform this action on the selected candidates?
      </p>
      <div class="flex justify-end space-x-3">
        <button
          onclick="closeBulkActionModal()"
          class="px-4 py-2 text-gray-600 bg-gray-200 rounded-lg hover:bg-gray-300"
        >
          Cancel
        </button>
        <button
          onclick="confirmBulkAction()"
          class="px-4 py-2 text-white bg-red-600 rounded-lg hover:bg-red-700"
          id="confirmButton"
        >
          Confirm
        </button>
      </div>
    </div>
  </div>
</div>
<script>
let currentFeedbackCandidateId = null;
let currentReassignCandidateId = null;

// Tab functionality
function showTab(tabId) {
    const tabContents = document.querySelectorAll(".tab-content");
    tabContents.forEach((content) => {
      content.style.display = "none";
    });
    const tabButtons = document.querySelectorAll(".tab-button");
    tabButtons.forEach((button) => {
      button.classList.remove("bg-blue-600", "text-white");
      button.classList.add("bg-gray-200", "text-gray-700");
    });
    document.getElementById(tabId).style.display = "block";
    event.target.classList.remove("bg-gray-200", "text-gray-700");
    event.target.classList.add("bg-blue-600", "text-white");
}

// Collapsible candidate functionality
function toggleCandidate(candidateId) {
    const details = document.getElementById(`candidate-${candidateId}`);
    const expandBtn =
      details.previousElementSibling.querySelector(".expand-btn i");
    if (details.classList.contains("hidden")) {
      details.classList.remove("hidden");
      expandBtn.classList.remove("fa-chevron-down");
      expandBtn.classList.add("fa-chevron-up");
    } else {
      details.classList.add("hidden");
      expandBtn.classList.remove("fa-chevron-up");
      expandBtn.classList.add("fa-chevron-down");
    }
  }

  // Feedback Modal Functions
function showFeedbackModal(candidateId, candidateName) {
    currentFeedbackCandidateId = candidateId;
    document.getElementById('feedbackCandidateId').value = candidateId;
    document.getElementById('feedbackCandidateName').textContent = candidateName;
    document.getElementById('feedbackModal').style.display = 'flex';
    
    // Reset form
    document.getElementById('feedbackForm').reset();
    document.getElementById('feedbackCandidateId').value = candidateId;
    document.getElementById('managerRatingSection').classList.add('hidden');
    document.getElementById('rejectionReasonsSection').classList.add('hidden');
}

function hideFeedbackModal() {
    document.getElementById('feedbackModal').style.display = 'none';
    currentFeedbackCandidateId = null;
}

  function toggleFeedbackSections() {
    const status = document.getElementById('feedbackStatus').value;
    const managerRatingSection = document.getElementById('managerRatingSection');
    const rejectionReasonsSection = document.getElementById('rejectionReasonsSection');
    
    // Hide both sections first
    managerRatingSection.classList.add('hidden');
    rejectionReasonsSection.classList.add('hidden');
    
    // Show appropriate section based on status
    if (status === 'Selected') {
      managerRatingSection.classList.remove('hidden');
    } else if (status === 'Not Selected') {
      rejectionReasonsSection.classList.remove('hidden');
    }
  }

  // Load request statistics
  async function loadRequestStats() {
    try {
      const response = await fetch('/manager/get-request-stats');
      const result = await response.json();
      
      if (result.success) {
        const stats = result.stats;
        const totalRequestsElement = document.getElementById('total-requests');
        if (totalRequestsElement) {
          totalRequestsElement.textContent = stats.total_remaining;
        }
        
        // Log the stats for debugging
        console.log('Request stats loaded:', stats);
      }
    } catch (error) {
      console.error('Error loading request stats:', error);
    }
  }
  
  // Refresh request stats every 30 seconds
  function startRequestStatsRefresh() {
    setInterval(loadRequestStats, 30000);
  }

  // Initialize when DOM is loaded
  document.addEventListener("DOMContentLoaded", function () {
    console.log("Manager dashboard loaded");
    initializeManagerStarRatings();
    initializeFeedbackForm();
    loadRequestStats();
    startRequestStatsRefresh();
  });

  // Initialize manager star rating system
  function initializeManagerStarRatings() {
    const starRatings = document.querySelectorAll('.star-rating');
    
    starRatings.forEach(ratingContainer => {
        const stars = ratingContainer.querySelectorAll('.star');
        const fieldName = ratingContainer.getAttribute('data-field');
        const hiddenInput = document.getElementById(fieldName);
        
        stars.forEach((star, index) => {
            star.addEventListener('click', () => {
                const rating = index + 1;
                
                // Update visual stars
                stars.forEach((s, i) => {
                    if (i < rating) {
                        s.textContent = '‚òÖ';
                        s.classList.add('filled');
                        s.style.color = '#fbbf24';
                    } else {
                        s.textContent = '‚óã';
                        s.classList.remove('filled');
                        s.style.color = '#6b7280';
                    }
                });
                
                // Update hidden input
                if (hiddenInput) {
                    hiddenInput.value = rating;
                }
                
                // Auto-calculate overall rating
                setTimeout(calculateManagerOverallRating, 100);
            });
            
            // Hover effects
            star.addEventListener('mouseenter', () => {
                const hoverRating = index + 1;
                stars.forEach((s, i) => {
                    if (i < hoverRating) {
                        s.style.color = '#fbbf24';
        } else {
                        s.style.color = '#6b7280';
                    }
                });
            });
            
            star.addEventListener('mouseleave', () => {
                const currentRating = parseInt(hiddenInput?.value || '0');
                stars.forEach((s, i) => {
                    if (i < currentRating) {
                        s.style.color = '#fbbf24';
                    } else {
                        s.style.color = '#6b7280';
                    }
                });
            });
        });
    });
  }

  // Calculate manager overall rating
  function calculateManagerOverallRating() {
    const ratings = {
        communication: parseInt(document.getElementById('communication_skills')?.value || '0'),
        technical: parseInt(document.getElementById('technical_skills')?.value || '0'),
        problemSolving: parseInt(document.getElementById('problem_solving')?.value || '0'),
        culturalFit: parseInt(document.getElementById('cultural_fit')?.value || '0')
    };
    
    // Check if at least one rating is provided
    const hasRatings = Object.values(ratings).some(rating => rating > 0);
    
    if (!hasRatings) {
        document.getElementById('manager_overall_rating_display').textContent = '--';
        document.getElementById('manager_overall_rating').value = '0';
        return;
    }
    
    // AI-like weighted calculation - only include ratings > 0
    let overallScore = 0;
    let totalWeight = 0;
    
    // Communication skills (weight: 25%)
    if (ratings.communication > 0) {
        overallScore += ratings.communication * 0.25;
        totalWeight += 0.25;
    }
    
    // Technical skills (weight: 30%)
    if (ratings.technical > 0) {
        overallScore += ratings.technical * 0.30;
        totalWeight += 0.30;
    }
    
    // Problem solving (weight: 25%)
    if (ratings.problemSolving > 0) {
        overallScore += ratings.problemSolving * 0.25;
        totalWeight += 0.25;
    }
    
    // Cultural fit (weight: 20%)
    if (ratings.culturalFit > 0) {
        overallScore += ratings.culturalFit * 0.20;
        totalWeight += 0.20;
    }
    
    // Calculate final score
    const finalScore = totalWeight > 0 ? Math.round(overallScore / totalWeight * 10) / 10 : 0;
    
    // Update display
    const displayElement = document.getElementById('manager_overall_rating_display');
    const hiddenInput = document.getElementById('manager_overall_rating');
    
    if (displayElement && hiddenInput) {
        displayElement.textContent = finalScore.toFixed(1);
        hiddenInput.value = finalScore;
        
        // Add color coding based on score
        if (finalScore >= 4.5) {
            displayElement.className = 'text-3xl font-bold text-green-400 mb-2';
        } else if (finalScore >= 3.5) {
            displayElement.className = 'text-3xl font-bold text-yellow-400 mb-2';
        } else {
            displayElement.className = 'text-3xl font-bold text-red-400 mb-2';
        }
    }
    
    console.log('Manager overall rating calculated:', finalScore);
    return finalScore;
  }

  // Reset manager ratings
  function resetManagerRatings() {
    const starRatings = document.querySelectorAll('.star-rating');
    const hiddenInputs = ['communication_skills', 'technical_skills', 'problem_solving', 'cultural_fit', 'manager_overall_rating'];
    
    starRatings.forEach(ratingContainer => {
        const stars = ratingContainer.querySelectorAll('.star');
        stars.forEach(star => {
            star.textContent = '‚óã';
            star.classList.remove('filled');
            star.style.color = '#6b7280';
        });
    });
    
    hiddenInputs.forEach(fieldId => {
        const input = document.getElementById(fieldId);
        if (input) input.value = '0';
    });
    
    const overallDisplay = document.getElementById('manager_overall_rating_display');
    if (overallDisplay) {
        overallDisplay.textContent = '--';
        overallDisplay.className = 'text-3xl font-bold text-pink-400 mb-2';
    }
  }

  // Handle feedback form submission
  function initializeFeedbackForm() {
    const feedbackForm = document.getElementById('feedbackForm');
    if (feedbackForm) {
        feedbackForm.addEventListener('submit', async function(e) {
    e.preventDefault();
            console.log('Feedback form submission started');
    
            // Get form data
    const formData = new FormData(this);
            const candidateId = formData.get('candidate_id');
            const status = formData.get('status');
            const communicationSkills = formData.get('communication_skills');
            const technicalSkills = formData.get('technical_skills');
            const problemSolving = formData.get('problem_solving');
            const culturalFit = formData.get('cultural_fit');
            const overallRating = formData.get('overall_rating');
            const overallImpression = formData.get('overall_impression');
            const feedback = formData.get('feedback');
            
            // Get rejection reasons if status is "Not Selected"
            let rejectionReasons = [];
            let rejectionNotes = '';
            if (status === 'Not Selected') {
                // Get checked rejection reasons
                const checkedReasons = document.querySelectorAll('#rejectionReasonsSection input[name="feedback_rejection_reasons"]:checked');
                rejectionReasons = Array.from(checkedReasons).map(cb => cb.value);
                
                // Get other notes if "Other" is selected
                const otherCheckbox = document.getElementById('feedback_other');
                if (otherCheckbox && otherCheckbox.checked) {
                    const otherNotes = document.getElementById('feedbackOtherNotes').value;
                    if (otherNotes.trim()) {
                        rejectionNotes = otherNotes.trim();
                    }
                }
                
                // Validate that rejection reasons are provided
                if (rejectionReasons.length === 0) {
                    showManagerNotification('Please select at least one rejection reason', 'error');
                    return;
                }
            }
            
            console.log('Form data:', {
                candidateId, status, communicationSkills, technicalSkills,
                problemSolving, culturalFit, overallRating, overallImpression, feedback,
                rejectionReasons, rejectionNotes
            });
            
            try {
                // Prepare data for submission
                const submitData = {
                    candidate_id: candidateId,
                    status: status,
                    communication_skills: parseInt(communicationSkills) || 0,
                    technical_skills: parseInt(technicalSkills) || 0,
                    problem_solving: parseInt(problemSolving) || 0,
                    cultural_fit: parseInt(culturalFit) || 0,
                    overall_rating: parseFloat(overallRating) || 0,
                    overall_impression: overallImpression || '',
                    feedback: feedback || '',
                    feedback_date: new Date().toISOString(),
                    rejection_reasons: rejectionReasons,
                    rejection_notes: rejectionNotes
                };
                
                // Submit to backend
                const response = await fetch('/manager/submit-feedback', {
        method: 'POST',
        headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(submitData)
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('Feedback submitted successfully:', result);
                    
                    // Show success message
                    showManagerNotification('Feedback submitted successfully!', 'success');
                    
                    // Close modal
                    hideFeedbackModal();
                    
                    // Refresh the dashboard to show updated data
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                    
        } else {
                    const errorData = await response.json();
                    console.error('Error submitting feedback:', errorData);
                    showManagerNotification('Error submitting feedback: ' + (errorData.error || 'Unknown error'), 'error');
                }
                
            } catch (error) {
                console.error('Error submitting feedback:', error);
                showManagerNotification('Error submitting feedback: ' + error.message, 'error');
            }
        });
    }
  }

// ===== MANAGER DATA ANALYTICS SYSTEM =====

// Global flags for analytics
let chartJsLoaded = false;
let chartJsLoading = false;
let forceSimplifiedMode = false;

// Manager Data Analytics Functions
function openDataVisualization() {
    const modal = document.getElementById('managerDataVisualizationModal');
    if (modal) {
        console.log('Opening Manager data visualization modal...');
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
        
        // Ensure the overview tab is visible by default
        switchManagerAnalyticsTab('overview');
        
        // Load Chart.js first, then load analytics data
        loadChartJsLibrary().then(() => {
            console.log('Chart.js loaded successfully for Manager, waiting for DOM to be ready...');
            setTimeout(() => {
                console.log('Starting Manager analytics data load...');
                loadManagerAnalyticsData();
                showManagerNotification('Loading Manager analytics data...', 'info');
            }, 500);
        }).catch(error => {
            console.error('Failed to load Chart.js for Manager:', error);
            showManagerNotification('Chart library failed to load. Using fallback display.', 'error');
            loadManagerAnalyticsDataWithFallback();
        });
    } else {
        console.error('Manager data visualization modal not found!');
    }
}

// Function to dynamically load Chart.js
function loadChartJsLibrary() {
    return new Promise((resolve, reject) => {
        // If already loaded, resolve immediately
        if (chartJsLoaded && typeof Chart !== 'undefined') {
            resolve();
            return;
        }
        
        // If already loading, wait for it to complete
        if (chartJsLoading) {
            const checkLoading = setInterval(() => {
                if (!chartJsLoading) {
                    clearInterval(checkLoading);
                    if (chartJsLoaded && typeof Chart !== 'undefined') {
                        resolve();
                    } else {
                        reject(new Error('Chart.js loading failed'));
                    }
                }
            }, 100);
            return;
        }
        
        chartJsLoading = true;
        
        // Check if Chart.js is already loaded
        if (typeof Chart !== 'undefined') {
            chartJsLoaded = true;
            chartJsLoading = false;
            resolve();
            return;
        }
        
        // Load Chart.js from CDN
        const script = document.createElement('script');
        script.src = 'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js';
        script.onload = () => {
            chartJsLoaded = true;
            chartJsLoading = false;
            resolve();
        };
        script.onerror = () => {
            console.warn('Primary CDN failed, trying fallback...');
            // Try fallback CDN
            const fallbackScript = document.createElement('script');
            fallbackScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js';
            fallbackScript.onload = () => {
                chartJsLoaded = true;
                chartJsLoading = false;
                resolve();
            };
            fallbackScript.onerror = () => {
                chartJsLoading = false;
                reject(new Error('Failed to load Chart.js from any CDN'));
            };
            document.head.appendChild(fallbackScript);
        };
        document.head.appendChild(script);
    });
}

function closeDataVisualization() {
    const modal = document.getElementById('managerDataVisualizationModal');
    if (modal) {
        modal.classList.add('hidden');
        modal.style.display = 'none';
    }
}

function switchManagerAnalyticsTab(tabName) {
    // Hide all tab contents
    const tabs = ['overview', 'trends', 'performance', 'reports'];
    tabs.forEach(tab => {
        const content = document.getElementById(`manager${tab.charAt(0).toUpperCase() + tab.slice(1)}Tab`);
        const button = document.getElementById(`manager${tab.charAt(0).toUpperCase() + tab.slice(1)}Button`);
        if (content) content.classList.add('hidden');
        if (button) {
            button.classList.remove('bg-blue-600', 'text-white');
            button.classList.add('bg-gray-200', 'text-gray-700');
        }
    });
    
    // Show selected tab
    const selectedContent = document.getElementById(`manager${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`);
    const selectedButton = document.getElementById(`manager${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Button`);
    
    if (selectedContent) {
        selectedContent.classList.remove('hidden');
    }
    if (selectedButton) {
        selectedButton.classList.remove('bg-gray-200', 'text-gray-700');
        selectedButton.classList.add('bg-blue-600', 'text-white');
    }
    
    // Load data for the selected tab
    loadManagerTabData(tabName);
}

function loadManagerAnalyticsData() {
    // Load all tabs starting with overview
    switchManagerAnalyticsTab('overview');
}

function loadManagerAnalyticsDataWithFallback() {
    try {
        showManagerNotification('Loading analytics in simplified mode...', 'info');
        
        // Show overview tab by default
        switchManagerAnalyticsTab('overview');
        
        // Replace charts with text summaries
        setTimeout(() => {
            createManagerFallbackCharts();
        }, 500);
        
    } catch (error) {
        console.error('Error loading Manager fallback analytics:', error);
        showManagerNotification('Error loading analytics', 'error');
    }
}

async function loadManagerTabData(tabName) {
    try {
        showManagerChartLoading(tabName);
        
        const response = await fetch(`/manager/analytics/${tabName}`);
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log(`Received Manager data for ${tabName}:`, data);
        
        if (!data.success) {
            throw new Error(data.message || 'Failed to load data');
        }
        
        // Wait for the DOM to be ready
        setTimeout(() => {
            console.log(`Processing Manager data for ${tabName} tab after DOM ready delay...`);
            
            // Verify tab container exists
            const tabContainer = document.getElementById(`manager${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`);
            if (!tabContainer) {
                console.error(`Manager tab container not found for ${tabName}`);
                hideManagerChartLoading(tabName);
                return;
            }
            console.log(`‚úÖ Manager tab container found for ${tabName}`);
            
            // Check if we should force simplified mode due to previous failures
            if (forceSimplifiedMode) {
                console.log('Forcing simplified mode for Manager due to previous canvas issues');
                renderManagerFallbackCharts(tabName, data);
                hideManagerChartLoading(tabName);
                showManagerNotification(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} loaded (simplified mode)`, 'info');
                return;
            }
            
            // Check if Chart.js is available
            if (typeof Chart === 'undefined') {
                console.warn('Chart.js library not available for Manager, using fallback');
                forceSimplifiedMode = true;
                renderManagerFallbackCharts(tabName, data);
                hideManagerChartLoading(tabName);
                showManagerNotification(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} loaded (simplified mode)`, 'info');
                return;
            }
            console.log(`‚úÖ Chart.js library is available for Manager`);
            
            // Try to ensure canvas elements, but proceed with fallback if fails
            const canvasReady = ensureManagerCanvasElements(tabName);
            if (!canvasReady) {
                console.warn(`Canvas elements not ready for Manager ${tabName}, switching to simplified mode permanently`);
                forceSimplifiedMode = true;
                renderManagerFallbackCharts(tabName, data);
                hideManagerChartLoading(tabName);
                showManagerNotification(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} loaded (simplified mode)`, 'info');
                return;
            }
            
            try {
                switch(tabName) {
                    case 'overview':
                        renderManagerOverviewCharts(data);
                        break;
                    case 'trends':
                        renderManagerTrendCharts(data);
                        break;
                    case 'performance':
                        renderManagerPerformanceCharts(data);
                        break;
                    case 'reports':
                        renderManagerReportCharts(data);
                        break;
                }
                
                hideManagerChartLoading(tabName);
                showManagerNotification(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} data loaded successfully`, 'success');
            } catch (error) {
                console.error(`Error rendering Manager ${tabName} charts:`, error);
                renderManagerFallbackCharts(tabName, data);
                hideManagerChartLoading(tabName);
                showManagerNotification(`${tabName.charAt(0).toUpperCase() + tabName.slice(1)} loaded (simplified mode)`, 'info');
            }
        }, 1000);
    } catch (error) {
        console.error(`Error loading Manager ${tabName} data:`, error);
        hideManagerChartLoading(tabName);
        showManagerNotification(`Failed to load ${tabName} data`, 'error');
    }
}

// Canvas management functions for Manager
function ensureManagerCanvasElements(tabName) {
    const requiredCanvases = {
        'overview': ['managerStatusChart', 'managerMonthlyChart'],
        'trends': ['managerTrendChart', 'managerSuccessChart'],
        'performance': ['managerTeamChart', 'managerResponseChart'],
        'reports': ['managerDepartmentChart', 'managerExperienceChart']
    };
    
    const canvasIds = requiredCanvases[tabName] || [];
    console.log(`Ensuring Manager canvas elements for ${tabName} tab:`, canvasIds);
    
    // Ensure modal is visible and tab is active
    const modal = document.getElementById('managerDataVisualizationModal');
    const tabContent = document.getElementById(`manager${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`);
    
    if (!modal || modal.style.display === 'none' || modal.classList.contains('hidden')) {
        console.error(`Manager modal not visible when checking canvas elements for ${tabName}`);
        return false;
    }
    
    if (!tabContent || tabContent.classList.contains('hidden')) {
        console.error(`Manager tab content not visible for ${tabName}`);
        return false;
    }
    
    let allFound = true;
    
    for (const canvasId of canvasIds) {
        let canvas = document.getElementById(canvasId);
        
        if (!canvas) {
            console.warn(`Manager canvas ${canvasId} not found, attempting to create it...`);
            
            // Try multiple strategies to create the canvas
            const existingCanvas = tabContent.querySelector(`canvas[id="${canvasId}"]`);
            if (existingCanvas) {
                console.log(`‚úÖ Found existing Manager canvas ${canvasId} in DOM`);
                canvas = existingCanvas;
        } else {
                // Look for chart-container divs
                const chartContainers = tabContent.querySelectorAll('.chart-container');
                let targetContainer = null;
                
                // Match container by position
                const canvasOrder = ['managerStatusChart', 'managerMonthlyChart', 'managerTrendChart', 'managerSuccessChart', 'managerTeamChart', 'managerResponseChart', 'managerDepartmentChart', 'managerExperienceChart'];
                const canvasIndex = canvasOrder.indexOf(canvasId);
                
                if (canvasIndex !== -1 && chartContainers[canvasIndex % chartContainers.length]) {
                    targetContainer = chartContainers[canvasIndex % chartContainers.length];
                } else {
                    targetContainer = chartContainers[0];
                }
                
                if (targetContainer) {
                    // Create the canvas element
                    canvas = document.createElement('canvas');
                    canvas.id = canvasId;
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                    
                    // Clear the container and add the canvas
                    targetContainer.innerHTML = '';
                    targetContainer.appendChild(canvas);
                    
                    console.log(`‚úÖ Created Manager canvas ${canvasId} dynamically in container`);
                } else {
                    // Create container and canvas from scratch
                    const newContainer = document.createElement('div');
                    newContainer.className = 'chart-container';
                    newContainer.style.height = '300px';
                    
                    canvas = document.createElement('canvas');
                    canvas.id = canvasId;
                    canvas.style.width = '100%';
                    canvas.style.height = '100%';
                    
                    newContainer.appendChild(canvas);
                    tabContent.appendChild(newContainer);
                    
                    console.log(`‚úÖ Created new Manager container and canvas ${canvasId} from scratch`);
                }
            }
        } else {
            console.log(`‚úÖ Manager Canvas ${canvasId} found`);
        }
    }
    
    if (allFound) {
        console.log(`‚úÖ All Manager canvas elements ready for ${tabName} tab`);
        return true;
    } else {
        console.error(`‚ùå Failed to ensure all Manager canvas elements for ${tabName}`);
        return false;
    }
}

// Chart rendering functions for Manager
const managerChartInstances = {};

function renderManagerPieChart(canvasId, config) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) {
        console.error(`Manager canvas with id '${canvasId}' not found`);
        return;
    }
    
    if (typeof Chart === 'undefined') {
        console.error('Chart.js library not available for Manager');
        return;
    }
    
    // Destroy existing chart if it exists
    if (managerChartInstances[canvasId]) {
        managerChartInstances[canvasId].destroy();
    }
    
    try {
        const ctx = canvas.getContext('2d');
        managerChartInstances[canvasId] = new Chart(ctx, {
            type: 'pie',
            data: config.data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.parsed} (${((context.parsed/context.dataset.data.reduce((a,b) => a+b, 0))*100).toFixed(1)}%)`;
                            }
                        }
                    }
                }
            }
        });
    } catch (error) {
        console.error(`Error creating Manager pie chart for ${canvasId}:`, error);
    }
}

function renderManagerBarChart(canvasId, config) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) {
        console.error(`Manager canvas with id '${canvasId}' not found`);
        return;
    }
    
    if (typeof Chart === 'undefined') {
        console.error('Chart.js library not available for Manager');
        return;
    }
    
    if (managerChartInstances[canvasId]) {
        managerChartInstances[canvasId].destroy();
    }
    
    try {
        const ctx = canvas.getContext('2d');
        managerChartInstances[canvasId] = new Chart(ctx, {
            type: 'bar',
            data: config.data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: config.showLegend !== false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    } catch (error) {
        console.error(`Error creating Manager bar chart for ${canvasId}:`, error);
    }
}

function renderManagerLineChart(canvasId, config) {
    const canvas = document.getElementById(canvasId);
    if (!canvas) {
        console.error(`Manager canvas with id '${canvasId}' not found`);
        return;
    }
    
    if (typeof Chart === 'undefined') {
        console.error('Chart.js library not available for Manager');
        return;
    }
    
    if (managerChartInstances[canvasId]) {
        managerChartInstances[canvasId].destroy();
    }
    
    try {
        const ctx = canvas.getContext('2d');
        managerChartInstances[canvasId] = new Chart(ctx, {
            type: 'line',
            data: config.data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: config.showLegend !== false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true
                    }
                },
                elements: {
                    line: {
                        tension: 0.4 // Smooth curves
                    }
                }
            }
        });
    } catch (error) {
        console.error(`Error creating Manager line chart for ${canvasId}:`, error);
    }
}

// Specific chart rendering functions for Manager
function renderManagerOverviewCharts(data) {
    const statusCounts = data.status_counts || {};
    
    // Status Distribution Pie Chart
    renderManagerPieChart('managerStatusChart', {
        data: {
            labels: Object.keys(statusCounts),
            datasets: [{
                data: Object.values(statusCounts),
                backgroundColor: [
                    '#10B981', // Green for Selected
                    '#EF4444', // Red for Not Selected
                    '#F59E0B', // Yellow for Pending
                    '#3B82F6'  // Blue for Assigned
                ]
            }]
        }
    });
    
    // Monthly Trends Bar Chart
    const monthlyData = data.monthly_data || {};
    renderManagerBarChart('managerMonthlyChart', {
        data: {
            labels: Object.keys(monthlyData),
            datasets: [{
                label: 'Candidates Processed',
                data: Object.values(monthlyData),
                backgroundColor: '#8B5CF6'
            }]
        }
    });
    
    // Update metrics
    const totalCandidates = data.total_candidates || 0;
    const selectedCount = statusCounts['Selected'] || 0;
    const pendingCount = statusCounts['Pending'] || 0;
    const successRate = totalCandidates > 0 ? Math.round((selectedCount / totalCandidates) * 100) : 0;
    
    document.getElementById('managerTotalCandidatesMetric').textContent = totalCandidates;
    document.getElementById('managerSelectedMetric').textContent = selectedCount;
    document.getElementById('managerPendingMetric').textContent = pendingCount;
    document.getElementById('managerSuccessRateMetric').textContent = `${successRate}%`;
}

function renderManagerTrendCharts(data) {
    // Trend Line Chart
    const trendData = data.trend_data || [];
    renderManagerLineChart('managerTrendChart', {
        data: {
            labels: trendData.map(d => d.date),
            datasets: [{
                label: 'Applications',
                data: trendData.map(d => d.applications),
                borderColor: '#8B5CF6',
                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                fill: true
            }, {
                label: 'Selections',
                data: trendData.map(d => d.selections),
                borderColor: '#10B981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                fill: true
            }]
        }
    });
    
    // Success Rate Trend
    renderManagerLineChart('managerSuccessChart', {
        data: {
            labels: trendData.map(d => d.date),
            datasets: [{
                label: 'Success Rate (%)',
                data: trendData.map(d => d.success_rate),
                borderColor: '#F59E0B',
                backgroundColor: 'rgba(245, 158, 11, 0.1)',
                fill: true
            }]
        }
    });
}

function renderManagerPerformanceCharts(data) {
    // Team Performance
    const teamData = data.team_data || {};
    renderManagerBarChart('managerTeamChart', {
        data: {
            labels: Object.keys(teamData),
            datasets: [{
                label: 'Candidates Processed',
                data: Object.values(teamData),
                backgroundColor: '#3B82F6'
            }]
        }
    });
    
    // Response Time
    const responseData = data.response_data || {};
    renderManagerLineChart('managerResponseChart', {
        data: {
            labels: Object.keys(responseData),
            datasets: [{
                label: 'Avg Response Time (days)',
                data: Object.values(responseData),
                borderColor: '#EF4444',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                fill: true
            }]
        }
    });
}

function renderManagerReportCharts(data) {
    // Department Distribution
    const deptData = data.department_data || {};
    renderManagerPieChart('managerDepartmentChart', {
        data: {
            labels: Object.keys(deptData),
            datasets: [{
                data: Object.values(deptData),
                backgroundColor: [
                    '#10B981', '#3B82F6', '#F59E0B', '#EF4444', '#8B5CF6', '#06B6D4'
                ]
            }]
        }
    });
    
    // Experience Level
    const expData = data.experience_data || {};
    renderManagerBarChart('managerExperienceChart', {
        data: {
            labels: Object.keys(expData),
            datasets: [{
                label: 'Candidates',
                data: Object.values(expData),
                backgroundColor: '#8B5CF6'
            }]
        }
    });
}

// Fallback chart rendering for Manager
function createManagerFallbackCharts() {
    console.log('Creating Manager fallback charts...');
    
    // Create fallback for all tabs
    const tabs = ['Overview', 'Trends', 'Performance', 'Reports'];
    tabs.forEach(tab => {
        const tabContent = document.getElementById(`manager${tab}Tab`);
        if (tabContent) {
            renderManagerFallbackCharts(tab.toLowerCase(), {});
        }
    });
}

function renderManagerFallbackCharts(tabName, data) {
    console.log(`Rendering Manager fallback charts for ${tabName}`);
    
    const statusCounts = data?.status_counts || {'Selected': 2, 'Not Selected': 1, 'Pending': 3, 'Assigned': 1};
    
    switch(tabName) {
        case 'overview':
            renderManagerFallbackOverview(statusCounts);
            break;
        case 'trends':
            renderManagerFallbackTrends();
            break;
        case 'performance':
            renderManagerFallbackPerformance();
            break;
        case 'reports':
            renderManagerFallbackReports();
            break;
    }
}

function renderManagerFallbackOverview(statusCounts) {
    // Replace status chart with summary
    const statusChartContainer = document.getElementById('managerStatusChart')?.parentElement;
    if (statusChartContainer) {
        statusChartContainer.innerHTML = `
            <div class="text-center p-8">
                <h4 class="text-lg font-semibold mb-4">Manager Performance Summary</h4>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-green-100 p-4 rounded">
                        <div class="text-2xl font-bold text-green-800">${statusCounts['Selected'] || 0}</div>
                        <div class="text-green-600">Selected</div>
                    </div>
                    <div class="bg-red-100 p-4 rounded">
                        <div class="text-2xl font-bold text-red-800">${statusCounts['Not Selected'] || 0}</div>
                        <div class="text-red-600">Not Selected</div>
                    </div>
                    <div class="bg-blue-100 p-4 rounded">
                        <div class="text-2xl font-bold text-blue-800">${statusCounts['Assigned'] || 0}</div>
                        <div class="text-blue-600">Assigned</div>
                    </div>
                    <div class="bg-yellow-100 p-4 rounded">
                        <div class="text-2xl font-bold text-yellow-800">${statusCounts['Pending'] || 0}</div>
                        <div class="text-yellow-600">Pending</div>
                    </div>
                </div>
            </div>
        `;
    }
    
    // Replace monthly chart with summary
    const monthlyChartContainer = document.getElementById('managerMonthlyChart')?.parentElement;
    if (monthlyChartContainer) {
        monthlyChartContainer.innerHTML = `
            <div class="text-center p-8">
                <h4 class="text-lg font-semibold mb-4">Monthly Activity</h4>
                <div class="space-y-2">
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span>This Month</span>
                        <span class="font-bold">7 candidates</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span>Last Month</span>
                        <span class="font-bold">5 candidates</span>
                    </div>
                    <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                        <span>Growth</span>
                        <span class="font-bold text-green-600">+40%</span>
                    </div>
                </div>
            </div>
        `;
    }
}

function renderManagerFallbackTrends() {
    // Similar implementation for trends
    console.log('Rendering Manager fallback trends...');
}

function renderManagerFallbackPerformance() {
    // Similar implementation for performance
    console.log('Rendering Manager fallback performance...');
}

function renderManagerFallbackReports() {
    // Similar implementation for reports
    console.log('Rendering Manager fallback reports...');
}

// Utility functions for Manager
function showManagerChartLoading(tabName) {
    const containers = document.querySelectorAll(`#manager${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab .chart-container`);
    containers.forEach(container => {
        container.innerHTML = `
            <div class="flex items-center justify-center h-full">
                <div class="text-center">
                    <i class="fas fa-spinner fa-spin text-3xl text-blue-500 mb-4"></i>
                    <p class="text-gray-600">Loading chart...</p>
                </div>
            </div>
        `;
    });
}

function hideManagerChartLoading(tabName) {
    // Loading is automatically hidden when charts are rendered
}

function showManagerNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 
        type === 'info' ? 'bg-blue-500' : 'bg-gray-500'
    } text-white`;
    
    notification.innerHTML = `
        <div class="flex items-center">
            <i class="fas ${
                type === 'success' ? 'fa-check-circle' : 
                type === 'error' ? 'fa-exclamation-circle' : 
                type === 'info' ? 'fa-info-circle' : 'fa-bell'
            } mr-2"></i>
            <span>${message}</span>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// Toggle Other Notes field visibility
function toggleOtherNotes() {
    const otherCheckbox = document.getElementById('other');
    const otherNotesField = document.getElementById('otherNotesField');
    
    if (otherCheckbox.checked) {
      otherNotesField.classList.remove('hidden');
    } else {
      otherNotesField.classList.add('hidden');
      // Clear the textarea when unchecked
      document.getElementById('otherNotes').value = '';
    }
  }

  // Toggle Feedback Other Notes field visibility
  function toggleFeedbackOtherNotes() {
    const otherCheckbox = document.getElementById('feedback_other');
    const otherNotesField = document.getElementById('feedbackOtherNotesField');
    
    if (otherCheckbox.checked) {
      otherNotesField.classList.remove('hidden');
    } else {
      otherNotesField.classList.add('hidden');
      // Clear the textarea when unchecked
      document.getElementById('feedbackOtherNotes').value = '';
    }
  }

  // Save rejection reasons
  async function saveRejectionReasons() {
    try {
      const candidateId = document.getElementById('rejectionCandidateId').value;
      const checkedReasons = Array.from(document.querySelectorAll('#rejectionReasonsModal input[name="rejection_reasons"]:checked')).map(cb => cb.value);
      const otherNotes = document.getElementById('otherNotes').value;
      
      if (checkedReasons.length === 0) {
        showNotification('Please select at least one rejection reason', 'error');
        return;
      }
      
      // Prepare data
      const data = {
        candidate_id: candidateId,
        rejection_reasons: checkedReasons,
        rejection_notes: otherNotes
      };
      
      // Send to backend
      const response = await fetch('/manager/save-rejection-reasons', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      });
      
      if (response.ok) {
        const result = await response.json();
        if (result.success) {
          showNotification('Rejection reasons saved successfully', 'success');
          hideRejectionReasonsModal();
          // Refresh the page to show updated data
                location.reload();
            } else {
          showNotification(result.message || 'Failed to save rejection reasons', 'error');
        }
      } else {
        showNotification('Failed to save rejection reasons', 'error');
      }
    } catch (error) {
      console.error('Error saving rejection reasons:', error);
      showNotification('Error saving rejection reasons', 'error');
    }
  }

  // Show rejection reasons modal
  function showRejectionReasonsModal(candidateId, candidateName) {
    document.getElementById('rejectionCandidateId').value = candidateId;
    document.getElementById('rejectionCandidateName').textContent = candidateName;
    document.getElementById('rejectionReasonsModal').style.display = 'flex';
    
    // Reset form
    document.getElementById('rejectionReasonsForm').reset();
    document.getElementById('otherNotesField').classList.add('hidden');
  }

  // Hide rejection reasons modal
  function hideRejectionReasonsModal() {
    document.getElementById('rejectionReasonsModal').style.display = 'none';
  }

  // Show reassign modal
  function showReassignModal(candidateId, candidateName) {
    document.getElementById('reassignCandidateName').textContent = candidateName;
    document.getElementById('reassignModal').style.display = 'flex';
    
    // Store candidate ID for form submission
    const reassignForm = document.getElementById('reassignForm');
    reassignForm.dataset.candidateId = candidateId;
  }

  // Hide reassign modal
  function hideReassignModal() {
    document.getElementById('reassignModal').style.display = 'none';
  }
</script>

<!-- Manager Data Visualization Modal -->
<div id="managerDataVisualizationModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-7xl max-h-screen flex flex-col transform transition-all duration-300">
        <!-- Modal Header -->
        <div class="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-4">
                        <i class="fas fa-chart-line text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold">Manager Data Analytics</h2>
                        <p class="text-blue-100">Advanced team performance insights & trends</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Date Filter -->
                    <div class="flex items-center space-x-2 bg-white bg-opacity-20 rounded-lg p-2">
                        <i class="fas fa-calendar text-sm"></i>
                        <input type="date" id="managerStartDate" class="bg-transparent text-white placeholder-blue-200 text-sm border-none outline-none">
                        <span class="text-blue-200">to</span>
                        <input type="date" id="managerEndDate" class="bg-transparent text-white placeholder-blue-200 text-sm border-none outline-none">
                    </div>
                    
                    <!-- Export Options -->
                    <div class="flex space-x-2">
                        <button class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-lg transition-colors">
                            <i class="fas fa-download text-sm"></i>
                        </button>
                        <button onclick="closeDataVisualization()" class="bg-white bg-opacity-20 hover:bg-opacity-30 p-2 rounded-lg transition-colors">
                            <i class="fas fa-times text-sm"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab Navigation -->
        <div class="bg-gray-50 border-b border-gray-200 px-6">
            <nav class="flex space-x-1 py-4">
                <button id="managerOverviewButton" onclick="switchManagerAnalyticsTab('overview')" class="bg-blue-600 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-chart-pie mr-2"></i>Overview
                </button>
                <button id="managerTrendsButton" onclick="switchManagerAnalyticsTab('trends')" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-chart-line mr-2"></i>Trends
                </button>
                <button id="managerPerformanceButton" onclick="switchManagerAnalyticsTab('performance')" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-users mr-2"></i>Performance
                </button>
                <button id="managerReportsButton" onclick="switchManagerAnalyticsTab('reports')" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-file-chart-line mr-2"></i>Reports
                </button>
            </nav>
        </div>
        
        <!-- Modal Content (Tabs) -->
        <div class="flex-1 overflow-y-auto p-6">
            <!-- Overview Tab -->
            <div id="managerOverviewTab" class="tab-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Status Distribution -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-pie-chart text-blue-500 mr-2"></i>
                            Candidate Status Distribution
                        </h3>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="managerStatusChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Monthly Performance -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-chart-bar text-green-500 mr-2"></i>
                            Monthly Performance
                        </h3>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="managerMonthlyChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Key Metrics -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100">Total Candidates</p>
                                <p class="text-3xl font-bold" id="managerTotalCandidatesMetric">0</p>
                            </div>
                            <i class="fas fa-users text-2xl text-blue-200"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-green-100">Selected</p>
                                <p class="text-3xl font-bold" id="managerSelectedMetric">0</p>
                            </div>
                            <i class="fas fa-check-circle text-2xl text-green-200"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-yellow-100">Pending Review</p>
                                <p class="text-3xl font-bold" id="managerPendingMetric">0</p>
                            </div>
                            <i class="fas fa-clock text-2xl text-yellow-200"></i>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-purple-100">Success Rate</p>
                                <p class="text-3xl font-bold" id="managerSuccessRateMetric">0%</p>
                            </div>
                            <i class="fas fa-trophy text-2xl text-purple-200"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Trends Tab -->
            <div id="managerTrendsTab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Performance Trend Lines -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-chart-line text-purple-500 mr-2"></i>
                            Performance Trend Lines
                        </h3>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="managerTrendChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Success Rate Trends -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-percentage text-orange-500 mr-2"></i>
                            Success Rate Trends
                        </h3>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="managerSuccessChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Tab -->
            <div id="managerPerformanceTab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Team Performance -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-users text-blue-500 mr-2"></i>
                            Team Performance
                        </h3>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="managerTeamChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Response Time Analysis -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-clock text-red-500 mr-2"></i>
                            Response Time Analysis
                        </h3>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="managerResponseChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="managerReportsTab" class="tab-content hidden">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Department Analysis -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-building text-green-500 mr-2"></i>
                            Department Analysis
                        </h3>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="managerDepartmentChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Experience Level Distribution -->
                    <div class="bg-white rounded-xl shadow-lg p-6 border border-gray-100">
                        <h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-graduation-cap text-purple-500 mr-2"></i>
                            Experience Level Distribution
                        </h3>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="managerExperienceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Candidate Request Modal -->
<div id="candidateRequestModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50">
  <div class="bg-white rounded-xl shadow-lg p-6 w-full max-w-lg mx-4">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-semibold text-gray-900">Request New Candidates</h3>
      <button onclick="hideCandidateRequestModal()" class="text-gray-400 hover:text-gray-600">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <form id="candidateRequestForm">
      <div class="space-y-4">
        <div>
          <label for="requestPosition" class="block text-sm font-medium text-gray-700 mb-2">Position Title</label>
          <input type="text" id="requestPosition" name="position" required
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                 placeholder="e.g., Software Developer, Marketing Specialist">
        </div>
        
        <div>
          <label for="requestCount" class="block text-sm font-medium text-gray-700 mb-2">Number of Candidates Needed</label>
          <input type="number" id="requestCount" name="count" required min="1" max="50"
                 class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                 placeholder="5">
        </div>
        
        <div>
          <label for="requestUrgency" class="block text-sm font-medium text-gray-700 mb-2">Urgency Level</label>
          <select id="requestUrgency" name="urgency" required
                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            <option value="">Select Urgency</option>
            <option value="Low">Low - Within 1 month</option>
            <option value="Medium">Medium - Within 2 weeks</option>
            <option value="High">High - Within 1 week</option>
            <option value="Critical">Critical - ASAP</option>
          </select>
        </div>
        
        <div>
          <label for="requestSkills" class="block text-sm font-medium text-gray-700 mb-2">Required Skills</label>
          <textarea id="requestSkills" name="skills" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="List key skills and requirements..."></textarea>
        </div>
        
        <div>
          <label for="requestNotes" class="block text-sm font-medium text-gray-700 mb-2">Additional Notes</label>
          <textarea id="requestNotes" name="notes" rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Any additional requirements or context..."></textarea>
        </div>
        
        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
          <p class="text-sm text-blue-800">
            <i class="fas fa-info-circle mr-2"></i>
            This request will be sent to all Recruiters and HR team members. They will be notified immediately.
          </p>
        </div>
        
        <div class="flex space-x-3">
          <button type="submit" 
                  class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg btn-animate">
            <i class="fas fa-paper-plane mr-2"></i>Send Request
          </button>
          <button type="button" onclick="hideCandidateRequestModal()"
                  class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 py-2 px-4 rounded-lg btn-animate">
            Cancel
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

<script>
// Candidate Request Modal Functions
function showCandidateRequestModal() {
    document.getElementById('candidateRequestModal').classList.remove('hidden');
    document.getElementById('candidateRequestModal').classList.add('flex');
}

function hideCandidateRequestModal() {
    document.getElementById('candidateRequestModal').classList.add('hidden');
    document.getElementById('candidateRequestModal').classList.remove('flex');
    document.getElementById('candidateRequestForm').reset();
}

// Handle candidate request form submission
document.getElementById('candidateRequestForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    const data = Object.fromEntries(formData);
    
    try {
        const response = await fetch('/manager/request-candidates', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showNotification('Candidate request submitted successfully! Recruiters will be notified.', 'success');
            hideCandidateRequestModal();
            // Optionally refresh current requests display
            loadCurrentRequests();
            } else {
            showNotification(result.message || 'Failed to submit request', 'error');
        }
    } catch (error) {
        console.error('Error submitting candidate request:', error);
        showNotification('Error submitting request', 'error');
    }
});

// Load current requests (placeholder function)
function loadCurrentRequests() {
    // Implementation to load and display current requests
    console.log('Loading current requests...');
}

// Show notification function
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
        type === 'success' ? 'bg-green-500 text-white' : 
        type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'
    }`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>

{% endblock %} 
